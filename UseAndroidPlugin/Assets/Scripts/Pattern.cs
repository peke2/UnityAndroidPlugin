using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class Pattern : MonoBehaviour {

	Button buttonPlay;
	Button buttonStop;
	Dropdown dropdownPatternList;

	Dictionary<string, Sound.Param> paramList;

	Vibration vibration;
	bool hasAmplitudeControl;

	//	手にスマホをぶつけた時の衝撃
	float[] pattern1 = new float[]{0.07226563f,0.08007813f,0.08007813f,0.08007813f,0.09960938f,0.09960938f,0.07519531f,0.08203125f,0.08398438f,0.1259766f,0.1240234f,0.1074219f,0.1074219f,0.08886719f,0.1386719f,0.1679688f,0.1894531f,0.2060547f,0.2060547f,0.1738281f,0.1181641f,0.1064453f,0.07519531f,0.02832031f,0.02832031f,0.02734375f,-0.04492188f,-0.1240234f,-0.1240234f,-0.1152344f,-0.1152344f,-0.05273437f,0f,0.07519531f,0.1259766f,0.06542969f,0.06542969f,0.07128906f,0.08789063f,-0.05761719f,-0.2021484f,-0.5107422f,-0.5107422f,-1.365234f,-1.668945f,-0.6904297f,7.147461f,-4.445313f,-4.445313f,-0.1572266f,-0.1503906f,-0.4873047f,0.2109375f,0.09179688f,0.09179688f,0.3505859f,0.1679688f,0.1552734f,0.06640625f,0.04492188f,0.04492188f,0.02734375f,0.1494141f,0.2216797f,0.28125f,0.1728516f,0.1728516f,0.02832031f,-0.04589844f,-0.01171875f,0.01171875f,-0.01464844f,-0.01464844f,-0.0009765625f,0.05175781f,0.0703125f,0.06054688f,0.09472656f,0.09472656f,0.1005859f,0.08300781f,0.05078125f,0.04101563f,0.04785156f,0.04785156f,0.05957032f,0.06640625f,0.05761719f,0.08984375f,0.1230469f,0.1230469f,0.1132813f,0.09960938f,0.08007813f,0.06445313f,0.1064453f,0.1064453f,0.1064453f,0.1162109f,0.1132813f,0.07714844f,0.07226563f,0.07226563f,0.09082031f,0.07128906f,0.03515625f,0.1191406f,0.1191406f,0.1191406f,0.1005859f,0.08398438f,0.1025391f,};
	//	机(硬いもの)にスマホをぶつけた時の衝撃(あまり勢いよくぶつけられていない)
	float[] pattern2 = new float[]{0.07421875f,0.09472656f,0.09472656f,0.1367188f,0.1396484f,0.1279297f,0.1699219f,0.1630859f,0.1630859f,0.1386719f,0.1269531f,0.1357422f,0.1601563f,0.1884766f,0.1884766f,0.1640625f,0.1806641f,0.2548828f,0.1689453f,0.1132813f,0.1132813f,0.1484375f,0.1445313f,0.04785156f,0f,0.02246094f,0.02246094f,-0.02148438f,0.03417969f,-0.01171875f,-0.01464844f,0.03710938f,0.03710938f,0.08203125f,0.1367188f,0.08496094f,0.1240234f,0.1542969f,0.1542969f,0.1298828f,0.08300781f,0.1308594f,0.2314453f,0.1621094f,0.1621094f,0.07617188f,-0.2041016f,0.2626953f,0.2783203f,0.1826172f,0.1826172f,0.01855469f,0.03320313f,-0.1132813f,-0.2509766f,-0.3417969f,-0.3417969f,-0.2138672f,0.2324219f,-0.4794922f,-0.1894531f,-0.03320313f,-0.03320313f,-0.03125f,0.1210938f,0.06738281f,0.02832031f,0.09277344f,0.09277344f,0.1240234f,0.07324219f,0.02734375f,0.08105469f,0.08984375f,0.08984375f,0.1220703f,0.06152344f,0.1201172f,0.2626953f,0.2216797f,0.2216797f,0.09960938f,-0.0078125f,0.02832031f,0.0703125f,-0.0078125f,-0.0078125f,0.0546875f,0.1035156f,0.05957032f,0.04785156f,0.05566406f,0.05566406f,0.1103516f,0.06152344f,0.05371094f,0.109375f,0.1308594f,0.1308594f,0.08203125f,0.05273437f,0.0390625f,0.1210938f,0.1826172f,0.1826172f,0.1777344f,0.1513672f,0.07128906f,};
	//	弁当のカートの網でガタガタ
	float[] pattern3 = new float[]{-0.09179688f,-0.07617188f,-0.04980469f,-0.09082031f,-0.09863281f,-0.09863281f,-0.1005859f,-0.09179688f,-0.05371094f,-0.0703125f,-0.1054687f,-0.1054687f,-0.0703125f,-0.05664063f,-0.1083984f,-0.2089844f,-0.2509766f,-0.2509766f,-0.09667969f,-0.05957032f,-0.07421875f,-0.0546875f,-0.08496094f,-0.08496094f,-0.2880859f,-0.5966797f,0.0859375f,-0.1757813f,-0.1201172f,-0.1201172f,0.1230469f,0.8027344f,-1.137695f,0.2255859f,-0.3076172f,-0.3076172f,0.1757813f,1.301758f,-1.602539f,-0.2529297f,-0.07421875f,-0.07421875f,0.8017578f,-0.2773438f,-0.6445313f,-0.04003906f,0.01074219f,0.01074219f,1.207031f,-1.21582f,-0.3427734f,-0.1777344f,1.532227f,1.532227f,-1.37207f,-0.3720703f,1.546875f,-0.5712891f,-0.5273438f,-0.5273438f,-0.4716797f,1.430664f,-0.3896484f,-0.2451172f,-0.6025391f,-0.6025391f,0.9238281f,-0.390625f,-0.2626953f,-0.4863281f,1.540039f,1.540039f,-0.8955078f,-0.05175781f,0.5488281f,0.1689453f,0.1972656f,0.1972656f,-1.31543f,-0.3964844f,0.3310547f,0.9345703f,-1.40918f,-1.40918f,-0.3056641f,1.114258f,0.3359375f,-0.8291015f,-0.2236328f,-0.2236328f,0.4912109f,1.200195f,-0.3671875f,-0.8847656f,-0.2167969f,-0.2167969f,0.07421875f,0.9707031f,-0.6855469f,-0.4902344f,0.6142578f,0.6142578f,0.5341797f,-1.31543f,-0.1435547f,0.09667969f,1.59668f,1.59668f,-0.4902344f,-0.6591797f,0.6806641f,-0.1796875f,-0.2763672f,-0.2763672f,-0.8320312f,0.2333984f,0.1201172f,1.238281f,-0.8154297f,-0.8154297f,-0.5556641f,0.2382813f,-0.1767578f,1.414063f,-0.09277344f,-0.09277344f,-0.625f,0.05175781f,0.1679688f,0.3417969f,-0.07421875f,-0.07421875f,0f,-0.4873047f,-0.4130859f,-0.2001953f,-0.01660156f,-0.01660156f,-0.09667969f,-0.1445313f,-0.2578125f,-0.1572266f,-0.1513672f,-0.1513672f,-0.1865234f,-0.2089844f,-0.2880859f,-0.2333984f,-0.2441406f,-0.2441406f,-0.1972656f,-0.2441406f,-0.2617188f,-0.2519531f,-0.2363281f,-0.2363281f,-0.2412109f,-0.2285156f,-0.2363281f,-0.2460938f,-0.2314453f,-0.2314453f,-0.25f,-0.2607422f,-0.2451172f,-0.2519531f,-0.2451172f,-0.2451172f,-0.2412109f,-0.2578125f,-0.2734375f,-0.2460938f,-0.2431641f,-0.2431641f,-0.2568359f,-0.265625f,-0.2509766f,-0.2734375f,-0.2158203f,-0.2158203f,-0.2089844f,-0.2275391f,};


	// Use this for initialization
	void Start () {
		GameObject gobj;
		gobj = GameObject.Find("ButtonPlay");
		buttonPlay = gobj.GetComponent<Button>();
		gobj = GameObject.Find("ButtonStop");
		buttonStop = gobj.GetComponent<Button>();

		buttonPlay.onClick.AddListener(onButtonPlay);
		buttonStop.onClick.AddListener(onButtonStop);
	
		gobj = GameObject.Find("Dropdown");
		dropdownPatternList = gobj.GetComponent<Dropdown>();

		paramList = new Dictionary<string, Sound.Param>();

		vibration = new Vibration();
		hasAmplitudeControl = vibration.hasAmplitudeControl();

		List<string> list = new List<string>();
		list.Add("pattern1");
		list.Add("pattern2");
		list.Add("pattern3");

		paramList["pattern1"] = createParam(pattern1, hasAmplitudeControl);
		paramList["pattern2"] = createParam(pattern2, hasAmplitudeControl);
		paramList["pattern3"] = createParam(pattern3, hasAmplitudeControl);
		dropdownPatternList.AddOptions(list);

	}
	
	// Update is called once per frame
	void Update () {
		
	}

	void onButtonPlay()
	{
		Dropdown.OptionData optdata;
		optdata = dropdownPatternList.options[dropdownPatternList.value];
		string name = optdata.text;

		Sound.Param param = paramList[name];
		vibration.vibrate(param.timings, param.amplitudes);
			
	}

	void onButtonStop()
	{
		vibration.cancel();
	}



	public static Sound.Param createParam(float[] pattern, bool hasAmplitudeControl)
	{
		int len = pattern.Length;

		Sound.Param param = new Sound.Param(len);

		for(int i=0; i<len; i++) {
			float v;
			v = pattern[i];

			v = Sound.clampVibration(v, Vibration.MAX_AMPLITUDE, hasAmplitudeControl);

			param.amplitudes[i] = (int)v;
			param.timings[i] = 16;	//	1/60秒固定
		}

		return param;
	}

}


